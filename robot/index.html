<style type="text/css">
#myImg {
  
  /* Preserve aspet ratio */
  min-width: 40%;
  min-height: 40%;
}
</style>


<script src="https://netpie.io/microgear.js"></script>
<script>
  const APPID     = "Led8x8Mono";
  const APPKEY    = "8NH4EmFlB4qIRe9";
  const APPSECRET = "Za2VI7miO3Zq1PkXfLmXyzR06";
  const ALIAS = "myX";
	
	var w = 87;
var a = 65;
var s = 83;
var d = 68;
var keyOut = "1234";
var x = 0;
	var ss = 0;
	var ssO = 0;
	
  
  var microgear = Microgear.create({
        key: APPKEY,
        secret: APPSECRET,
        alias : ALIAS         /*  optional  */
    });
  
  var imgX = "data:image/jpeg;base64,";
  
  microgear.on('message',function(topic,msg) {
    	//
     document.getElementById("myImg").src = imgX+msg;
	  
	
    });
    
     microgear.on('connected', function() {
       
        document.getElementById("data").innerHTML = "Now I am connected with netpie...";
    
	      microgear.subscribe("/video/1");
	     
	     //
	     	 document.getElementById("demo").innerHTML = keyOut;
//
//key down
document.addEventListener('keydown', function(event) {
    
    if (event.keyCode == w) {
        keyOut = keyOut.replace("1", "w");
      }
if (event.keyCode == a) {
        keyOut = keyOut.replace("2", "a");
      }
if (event.keyCode == s) {
        keyOut = keyOut.replace("3", "s");
      }
if (event.keyCode == d) {
        keyOut = keyOut.replace("4", "d");
      }
    
}, true);
//
//key up
document.addEventListener('keyup', function(event) {
    
    if (event.keyCode == w) {
        keyOut = keyOut.replace("w", "1");
      }
if (event.keyCode == a) {
        keyOut = keyOut.replace("a", "2");
      }
if (event.keyCode == s) {
        keyOut = keyOut.replace("s", "3");
      }
if (event.keyCode == d) {
        keyOut = keyOut.replace("d", "4");
      }
    
}, true);
	     
 setInterval(function() {
	 
	  if(ssO == 1){
	    	microgear.chat("aVideo","start");
		 ssO = 0;
	    }
	 
	 
	 if(ss == 1){
         	document.getElementById("demo").innerHTML = keyOut;
	 	microgear.chat("aVideo",keyOut);
 	}else{
	     document.getElementById("demo").innerHTML = "press button";	
	}
	 

	 
 },100);
	     
	     
	     
	     
	     //
    });
    
     microgear.on('present', function(event) {
        console.log(event);
    });
    microgear.on('absent', function(event) {
        console.log(event);
    });
	
	microgear.on("error", function(err) {
		console.log("Error: "+err);
    document.getElementById("data").innerHTML = err;
	
	});
    microgear.connect(APPID);
	
	function stratVideo(){
		
		ss = 1;
		//microgear.chat("aVideo","start");
		//microgear.chat("aVideo","start");
		ssO = 1;
		
		
	}
	
	function stopVideo(){
		
		ss = 0;
		microgear.chat("aVideo","stop");
		//microgear.chat("aVideo","stop");
		
	}



    
    </script>
    
    <div id="data">Waite for conect NetPie</div>
<input id="sv" type="button" value="stratVideo" onclick="stratVideo();" />
<input id="stv" type="button" value="stopVideo" onclick="stopVideo();" />
<h2 id="demo2"> Use W A S D key to control </h2>
<p id="demo">-</p>

    <img id = "myImg" src = "imgX"/>

