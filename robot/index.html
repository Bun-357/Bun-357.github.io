<style type="text/css">
#myImg {
  
  /* Preserve aspet ratio */
  min-width: 35%;
  min-height: 35%;
}
</style>


<script src="https://netpie.io/microgear.js"></script>
<script>
  const APPID     = "Led8x8Mono";
  const APPKEY    = "8NH4EmFlB4qIRe9";
  const APPSECRET = "Za2VI7miO3Zq1PkXfLmXyzR06";
  const ALIAS = "myX";
	
	var w = 87;
var a = 65;
var s = 83;
var d = 68;
var keyOut = "1234";
var x = 0;
	
  
  var microgear = Microgear.create({
        key: APPKEY,
        secret: APPSECRET,
        alias : ALIAS         /*  optional  */
    });
  
  var imgX = "data:image/jpeg;base64,";
  
  microgear.on('message',function(topic,msg) {
    	//
     document.getElementById("myImg").src = imgX+msg;
    });
    
     microgear.on('connected', function() {
       
        document.getElementById("data").innerHTML = "Now I am connected with netpie...";
    
	      microgear.subscribe("/video/1");
	     
	     //
	     	 document.getElementById("demo").innerHTML = keyOut;
//
//key down
document.addEventListener('keydown', function(event) {
    
    if (event.keyCode == w) {
        keyOut = keyOut.replace("1", "w");
      }
if (event.keyCode == a) {
        keyOut = keyOut.replace("2", "a");
      }
if (event.keyCode == s) {
        keyOut = keyOut.replace("3", "s");
      }
if (event.keyCode == d) {
        keyOut = keyOut.replace("4", "d");
      }
    
}, true);
//
//key up
document.addEventListener('keyup', function(event) {
    
    if (event.keyCode == w) {
        keyOut = keyOut.replace("w", "1");
      }
if (event.keyCode == a) {
        keyOut = keyOut.replace("a", "2");
      }
if (event.keyCode == s) {
        keyOut = keyOut.replace("s", "3");
      }
if (event.keyCode == d) {
        keyOut = keyOut.replace("d", "4");
      }
    
}, true);
	     
 setInterval(function() {
  document.getElementById("demo").innerHTML = keyOut;
	 microgear.chat("aVideo",keyOut);
 },100);
	     
	     
	     
	     
	     //
    });
    
     microgear.on('present', function(event) {
        console.log(event);
    });
    microgear.on('absent', function(event) {
        console.log(event);
    });
	
	microgear.on("error", function(err) {
		console.log("Error: "+err);
    document.getElementById("data").innerHTML = err;
	
	});
    microgear.connect(APPID);
	
	


    
    </script>
    
    <div id="data">Waite for conect NetPie</div>
<h2 id="demo2"> Use W A S D key to control </h2>
<p id="demo">-</p>
    <img id = "myImg" src = "imgX"/>
